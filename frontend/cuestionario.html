<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Formulario por secciones</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.13.1/font/bootstrap-icons.css">
    <link rel="stylesheet" href="Styles/form.css">
</head>

<body>

<div class="container">

    <!-- SECCIÃ“N 1 -->
    <div id="section1" class="section active">
        <h2>Estado emocional general</h2>

        <div class="question">
            <label>Â¿CuÃ¡l es tu estado de Ã¡nimo actual?</label>
            <select id="mood">
                <option>Feliz</option>
                <option>triste</option>
                <option>estresado</option>
                <option>ansioso</option>
                <option>relajado</option>
                <option>sin energÃ­a</option>
                <option>motivado</option>
                <option>neutral</option>
            </select>
        </div>

        <div class="question">
            <label>Â¿CÃ³mo describirÃ­as tu nivel de ansiedad hoy? (1â€“10)</label>
            <input id="anxietyLevel" type="number" min="1" max="10">
        </div>

        <div class="question">
            <label>Â¿QuÃ© tan estresado te sientes actualmente? (1â€“10)</label>
            <input id="stressLevel" type="number" min="1" max="10">
        </div>

        <div class="question">
            <label>Describe tu preocupaciÃ³n principal del dÃ­a:</label>
            <textarea id="mainConcern" rows="3"></textarea>
        </div>

        <button onclick="nextSection(1)">Siguiente</button>
    </div>

    <!-- SECCIÃ“N 2 -->
    <div id="section2" class="section">
        <button class="back-btn" onclick="previousSection(2)"><i class="bi bi-arrow-left"></i></button>
        <h2>Salud emocional especÃ­fica</h2>

        <div class="question">
            <label>Â¿Has tenido problemas para dormir?</label>
            <select id="sleepProblem" onchange="toggleSleepSeverity()">
                <option value="SÃ­">SÃ­</option>
                <option value="No">No</option>
            </select>
        </div>

        <div id="sleepSeverityBox" class="question" style="display:none;">
            <label>Â¿QuÃ© tan grave ha sido? (1â€“10)</label>
            <input id="sleepSeverity" type="number" min="1" max="10">
        </div>

        <div class="question">
            <label>Â¿Pensamientos repetitivos o dificultad para desconectarte? (1â€“10)</label>
            <input id="rumination" type="number" min="1" max="10">
        </div>

        <div class="question">
            <label>Â¿Te has sentido triste o con baja autoestima? (1â€“10)</label>
            <input id="lowMood" type="number" min="1" max="10">
        </div>

        <button onclick="nextSection(2)">Siguiente</button>
    </div>

    <!-- SECCIÃ“N 3 -->
    <div id="section3" class="section">
        <button class="back-btn" onclick="previousSection(3)"><i class="bi bi-arrow-left"></i></button>
        <h2>Preferencias musicales</h2>

        <div class="question">
            <label>Â¿CuÃ¡les son tus gÃ©neros musicales favoritos?</label>
            <div class="checkbox-group">
                <label><input type="checkbox" class="genreCheck" value="lofi"> lofi</label>
                <label><input type="checkbox" class="genreCheck" value="pop"> pop</label>
                <label><input type="checkbox" class="genreCheck" value="rock"> rock</label>
                <label><input type="checkbox" class="genreCheck" value="reggaetÃ³n"> reggaetÃ³n</label>
                <label><input type="checkbox" class="genreCheck" value="electrÃ³nica"> electrÃ³nica</label>
                <label><input type="checkbox" class="genreCheck" value="clÃ¡sica"> clÃ¡sica</label>
            </div>
        </div>

        <div class="question">
            <label>Artistas que escuchas con mÃ¡s frecuencia:</label>
            <input id="artists" type="text">
        </div>

        <button onclick="sendData()">Finalizar</button>
    </div>

</div>

<script>
function nextSection(current) {
    document.getElementById("section" + current).classList.remove("active");
    document.getElementById("section" + (current + 1)).classList.add("active");
}

function previousSection(current) {
    document.getElementById("section" + current).classList.remove("active");
    document.getElementById("section" + (current - 1)).classList.add("active");
}

function toggleSleepSeverity() {
    const box = document.getElementById("sleepSeverityBox");
    const val = document.getElementById("sleepProblem").value;
    box.style.display = val === "SÃ­" ? "block" : "none";
}

function sendData() {

    // GÃ©neros seleccionados
    const genres = Array.from(
        document.querySelectorAll('input[name="generos[]"]:checked')
    ).map(x => x.value);

    // JSON final
    const body = {
        mood: document.getElementById("mood").value.toLowerCase(),
        anxiety: Number(document.getElementById("anxietyLevel").value),
        stress: Number(document.getElementById("stressLevel").value),

        energy: 0,
        motivation: 0,

        sleepIssues: { 
            hasProblem: document.getElementById("sleepProblem").value === "SÃ­",
            severity: document.getElementById("sleepProblem").value === "SÃ­"
                      ? Number(document.getElementById("sleepSeverity").value)
                      : 0
        },

        genres: genres,

        listenByGenre: {},

        emotionalSensitivity: {
            affectedWhenSad: Number(document.getElementById("lowMood").value) >= 5,
            avoidGenres: [],
            noiseSensitivity: Number(document.getElementById("rumination").value),
            lyricSensitivity: Number(document.getElementById("lowMood").value)
        },

        activity: "relajarse",
        goal: ["dormir", "bajarAnsiedad"],
        duration: "1h"
    };

    console.log("ğŸ“¤ Enviando JSON:", body);

    fetch("http://localhost:5000/api/jilmar/recommend", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(body)
    })
    .then(res => res.json())
    .then(data => {
        console.log("ğŸ“¥ Respuesta del servidor:", data);
        alert("RecomendaciÃ³n generada (ver consola)");
    })
    .catch(err => {
        console.error("âŒ Error:", err);
    });
}
</script>

</body>
</html>